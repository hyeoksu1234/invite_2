(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642,659],{3443:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/components/IndexClient",function(){return n(2659)}])},2659:function(e,t,n){"use strict";n.r(t);var i=n(5893),a=n(7294),l=n(1664),r=n.n(l),o=n(1163),c=n(1943);t.default=()=>{let{basePath:e}=(0,o.useRouter)(),t=t=>{let n=t.startsWith("/")?t:"/".concat(t);return"".concat(null!=e?e:"").concat(n)},[n,l]=(0,a.useState)(!1),[d,s]=(0,a.useState)(""),[u,m]=(0,a.useState)(""),[h,f]=(0,a.useState)(!1),g=(0,a.useRef)(null),v=(0,a.useRef)(null),w=(0,a.useRef)(null),p=(0,a.useRef)(null),[x,y]=(0,a.useState)(null),S=(0,a.useMemo)(()=>({to:{weight:400,manualSize:60},from:{weight:400,manualSize:60}}),[]),b=(0,a.useMemo)(()=>({to:{weight:400,manualSize:60},from:{weight:400,manualSize:60}}),[]),z=(0,a.useCallback)(()=>{var e;let t=p.current,n=w.current,i=null!==(e=null==t?void 0:t.clientWidth)&&void 0!==e?e:null==n?void 0:n.clientWidth;if(!i)return;let a=i/1024;y(e=>null===e?a:Math.abs(e-a)>.005?a:e)},[]);(0,a.useEffect)(()=>{z();let e=w.current;if(!e||"undefined"==typeof ResizeObserver)return;let t=new ResizeObserver(()=>z());return t.observe(e),()=>t.disconnect()},[z]),(0,a.useEffect)(()=>{let e=p.current;if(e){if(e.complete){z();return}return e.addEventListener("load",z),()=>e.removeEventListener("load",z)}},[z]);let j=(0,a.useMemo)(()=>{var e,t,n,i;if(!x)return;let a={},l=null!==(e=b.to.manualSize)&&void 0!==e?e:0,r=null!==(t=b.from.manualSize)&&void 0!==t?t:0,o=null!==(n=b.to.weight)&&void 0!==n?n:400,c=null!==(i=b.from.weight)&&void 0!==i?i:400;if(l>0){let e=x*l;a["--landing-to-font-size"]="".concat(Math.round(e),"px"),a["--landing-to-line-height"]="".concat(Math.round(1.08*e),"px")}if(r>0){let e=x*r;a["--landing-from-font-size"]="".concat(Math.round(e),"px"),a["--landing-from-line-height"]="".concat(Math.round(1.08*e),"px")}return a["--landing-to-font-weight"]="".concat(o),a["--landing-from-font-weight"]="".concat(c),a},[x,S]),R=async()=>{if(h)return;let e=g.current;if(!e){window.alert("초대장 미리보기가 준비되지 않았습니다.");return}let t=d.trim(),n=u.trim();if(0===e.width||0===e.height){window.alert("초대장 미리보기를 불러오는 중입니다. 잠시 후 다시 시도해 주세요.");return}f(!0);try{let l;if(!v.current)throw Error("다운로드 링크가 준비되지 않았습니다.");let r="invitation-from-".concat(encodeURIComponent(n||"unknown"),"-to-").concat(encodeURIComponent(t||"guest"),".png"),o=null,c=null;if(e.toBlob&&(o=await new Promise(t=>e.toBlob(t,"image/png"))),!o){let t=e.toDataURL("image/png");c=t;let n=t.indexOf(","),i=n>-1?t.slice(5,t.indexOf(";")):"image/png",a=atob(n>-1?t.slice(n+1):t),l=new ArrayBuffer(a.length),r=new Uint8Array(l);for(let e=0;e<a.length;e+=1)r[e]=a.charCodeAt(e);o=new Blob([r],{type:i})}if(!o)throw Error("초대장 이미지를 생성하지 못했습니다.");let d="undefined"!=typeof navigator?navigator:void 0,s="undefined"!=typeof navigator?navigator.userAgent:"",u=/iP(ad|hone|od)/i.test(s),m=u&&/Safari/i.test(s)&&!/CriOS|FxiOS|EdgiOS/i.test(s),h=!u&&/Safari/i.test(s)&&!/Chrome|CriOS|Edg|OPR/i.test(s),f=/Android/i.test(s),g={title:n?"".concat(n,"의 초대장"):"초대장",text:t?"".concat(t," 님께 전달하는 초대장입니다."):"초대장을 함께 확인해 주세요."};if("undefined"!=typeof File)try{g.files=[new File([o],r,{type:"image/png"})]}catch(e){}let w=!!(null==d?void 0:d.share),p=(()=>{var e;if(!w||!d||!(null===(e=g.files)||void 0===e?void 0:e.length))return!1;if("function"!=typeof d.canShare)return!0;try{return d.canShare({files:g.files})}catch(e){return!1}})(),x=w&&(u||f||m||h),y=async e=>{if(!(null==d?void 0:d.share))return!1;try{return await d.share(e),!0}catch(e){return console.warn("초대장 공유에 실패했습니다.",e),!1}},S=!1;if(x&&(null==d?void 0:d.share)&&(g.files&&p&&(S=await y(g)),!S)){var i,a;let e={title:g.title,text:null!==(a=null!==(i=g.text)&&void 0!==i?i:g.title)&&void 0!==a?a:"초대장을 함께 확인해 주세요."};S=await y(e)}let b=c;if(!b){let e=URL.createObjectURL(o);b=e,l=()=>URL.revokeObjectURL(e)}if(S){null==l||l();return}!((e,t)=>{let n=v.current,i=(()=>{if("undefined"==typeof document)return!1;let e=document.createElement("a");return"download"in e})(),a="undefined"!=typeof navigator&&/iP(ad|hone|od)/i.test(navigator.userAgent);if(!a&&i&&n)return n.href=e,n.download=r,n.click(),n.removeAttribute("download"),n.removeAttribute("href"),null==t||t(),!0;let l=document.createElement("a");return l.href=e,l.download=r,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),t&&window.setTimeout(t,1500),!a})(b,l)&&x&&(null==d?void 0:d.share)&&await y(g)}catch(e){console.error(e),window.alert("초대장을 저장하지 못했습니다. 다시 시도해 주세요.")}finally{f(!1)}};return(0,i.jsx)("main",{className:"landing",children:(0,i.jsxs)("div",{className:"landing-wrapper",ref:w,children:[(0,i.jsx)("img",{src:t("/invitation.png"),alt:"졸업전시 초대장 미리보기 이미지",className:"landing-image-only",ref:p,onLoad:z}),(0,i.jsx)("div",{className:"landing-overlay".concat(n?" landing-overlay--readonly":""),style:n?void 0:j,children:n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"landing-result-card","aria-live":"polite","aria-label":"완성된 초대장 미리보기",children:(0,i.jsx)(c.default,{from:u,to:d,canvasRef:g,className:"landing-result-canvas",imageSrc:"/invitation_2.svg",fontOptions:S})}),(0,i.jsxs)("div",{className:"landing-result-actions",children:[(0,i.jsx)("button",{type:"button",className:"landing-result-action",onClick:R,disabled:h,"aria-label":h?"초대장 저장 중":"초대장 저장하기",children:(0,i.jsx)("img",{src:t("/save.svg"),alt:""})}),(0,i.jsx)("button",{type:"button",className:"landing-result-action landing-result-action--retry",onClick:()=>{f(!1),l(!1),s(""),m("")},"aria-label":"이름 다시 입력하기",children:(0,i.jsx)("img",{src:t("/retry.svg"),alt:""})})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("label",{className:"landing-field landing-field--to",htmlFor:"landing-to-input",children:[!d&&(0,i.jsx)("img",{src:t("/write.png"),alt:"",className:"landing-placeholder landing-placeholder--to"}),(0,i.jsx)("input",{id:"landing-to-input",className:"landing-input","aria-label":"초대장을 받는 분",maxLength:20,value:d,onChange:e=>s(e.target.value)})]}),(0,i.jsxs)("label",{className:"landing-field landing-field--from",htmlFor:"landing-from-input",children:[!u&&(0,i.jsx)("img",{src:t("/write.png"),alt:"",className:"landing-placeholder landing-placeholder--from"}),(0,i.jsx)("input",{id:"landing-from-input",className:"landing-input","aria-label":"초대장을 보내는 분",maxLength:20,value:u,onChange:e=>m(e.target.value)})]})]})}),!n&&(0,i.jsx)(r(),{href:"/generator",className:"landing-button",prefetch:!1,"aria-label":"초대장 만들기 페이지로 이동",onClick:e=>{n||(e.preventDefault(),l(!0))},children:(0,i.jsx)("img",{src:t("/button_1.svg"),alt:"초대장 만들기 이동 버튼"})}),(0,i.jsx)("a",{ref:v,style:{display:"none"},"aria-hidden":"true"})]})})}},1943:function(e,t,n){"use strict";n.r(t);var i=n(5893),a=n(7294),l=n(1163);let r='"rixdongnimgothic-pro","tk-rixdongnimgothic-pro",sans-serif',o={weight:700,minSize:48,maxSize:900,targetWidthRatio:.92,manualSize:0},c={weight:700,minSize:48,maxSize:820,targetWidthRatio:.92,manualSize:0};t.default=e=>{let{from:t,to:n,canvasRef:d,className:s,imageSrc:u="/invitation_2.svg",fontOptions:m}=e,{basePath:h}=(0,l.useRouter)(),f=(0,a.useCallback)(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat(null!=h?h:"").concat(t)},[h]),g=(0,a.useMemo)(()=>({to:{...o,...null==m?void 0:m.to},from:{...c,...null==m?void 0:m.from}}),[m]),[v,w]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null),[y,S]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=!0;w(!1),x(null);let t=new Image;return t.crossOrigin="anonymous",t.onload=()=>{e&&(S(t),x(null))},t.onerror=()=>{e&&(S(null),w(!1),x("초대장 이미지를 불러오지 못했습니다."))},(async()=>{var e;if(document.fonts&&"ready"in document.fonts)try{await document.fonts.ready}catch(e){}if(null===(e=document.fonts)||void 0===e?void 0:e.load)try{let e=Array.from(new Set([g.to.weight,g.from.weight]));await Promise.all(e.flatMap(e=>[document.fonts.load("".concat(e," ").concat(36,"px rixdongnimgothic-pro")),document.fonts.load("".concat(e," ").concat(36,"px 'rixdongnimgothic-pro'")),document.fonts.load("".concat(e," ").concat(36,"px 'tk-rixdongnimgothic-pro'"))]))}catch(e){}})().finally(()=>{t.src=f(u)}),()=>{e=!1}},[f,u,g]),(0,a.useEffect)(()=>{let e=d.current,i=null==e?void 0:e.getContext("2d");if(!e||!i||!y)return;let a=()=>{let a=(t,n,a,l)=>{let o=t.trim();if(!o)return;let c=Math.round(e.height*n),d=Math.min(.98*e.width,e.width*l.targetWidthRatio),s=(e,t)=>{i.font="".concat(t," ").concat(e,"px ").concat(r);let n=i.measureText(o);return n.actualBoundingBoxRight-n.actualBoundingBoxLeft||n.width},u=l.manualSize>0?Math.max(l.minSize,Math.min(l.maxSize,Math.round(l.manualSize*(e.width/1024)))):l.minSize;if(l.manualSize<=0){let e=l.minSize,t=Math.max(l.minSize,l.maxSize),n=l.minSize;for(;e<=t;){let i=Math.floor((e+t)/2);s(i,l.weight)<=d?(n=i,e=i+2):t=i-2}u=Math.min(n,l.maxSize)}i.font="".concat(l.weight," ").concat(u,"px ").concat(r),i.textAlign="center",i.textBaseline="middle",i.fillStyle="#121212";let m=e.width/2+a;i.fillText(o,m,c)};i.drawImage(y,0,0,e.width,e.height),a(n,.12021857923497267,-90,g.to),a(t,.5591985428051002,125,g.from)},l=null,o=()=>{let t=e.getBoundingClientRect(),n=Math.max(1,window.devicePixelRatio||1),l=Math.max(768,Math.min(2304,Math.round((t.width||y.width)*n*2)||768)),r=Math.max(1,Math.round(l*(y.naturalHeight&&y.naturalWidth?y.naturalHeight/y.naturalWidth:1.4296875)));(e.width!==l||e.height!==r)&&(e.width=l,e.height=r);let o=t.width||l/n,c=r/l*o;e.style.width="".concat(o,"px"),e.style.height="".concat(c,"px"),i.clearRect(0,0,e.width,e.height),a(),w(!0),x(null)};o();let c="undefined"!=typeof ResizeObserver?new ResizeObserver(()=>{l&&cancelAnimationFrame(l),l=window.requestAnimationFrame(o)}):null;null==c||c.observe(e);let s=()=>{l&&cancelAnimationFrame(l),l=window.requestAnimationFrame(o)};return window.addEventListener("resize",s),()=>{null==c||c.disconnect(),l&&cancelAnimationFrame(l),window.removeEventListener("resize",s)}},[d,t,n,y,g]),(0,i.jsxs)("div",{className:"invitation-wrapper",children:[!v&&(0,i.jsx)("div",{className:"canvas-status",children:null!=p?p:"초대장 이미지를 불러오는 중입니다..."}),(0,i.jsx)("canvas",{ref:d,className:null!=s?s:"invitation-canvas"})]})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=3443)}),_N_E=e.O()}]);